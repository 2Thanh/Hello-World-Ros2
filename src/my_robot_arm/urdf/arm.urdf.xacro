<?xml version="1.0"?>
<robot name="4dof_arm" xmlns:xacro="http://www.ros.org/wiki/xacro">
    <!-- World link -->
    <link name="world"/>
    
    <!-- Base Link -->
    <link name="base_link">
        <inertial>
            <mass value="1.0"/>
            <origin rpy="0 0 0" xyz="0 0 0.025"/>
            <inertia ixx="0.0027" iyy="0.0027" izz="0.005" ixy="0" ixz="0" iyz="0"/>
        </inertial>
        <visual>
            <geometry>
                <cylinder length="0.05" radius="0.1"/>
            </geometry>
            <material name="silver">
                <color rgba="0.75 0.75 0.75 1"/>
            </material>
            <origin rpy="0 0 0" xyz="0 0 0.025"/>
        </visual>
        <collision>
            <geometry>
                <cylinder length="0.05" radius="0.1"/>
            </geometry>
            <origin rpy="0 0 0" xyz="0 0 0.025"/>
        </collision>
    </link>
    
    <!-- Fixed joint connecting world to base_link -->
    <joint name="fixed" type="fixed">
        <parent link="world"/>
        <child link="base_link"/>
    </joint>
    
    <!-- Link 1 (First vertical link) -->
    <link name="link1">
        <inertial>
            <mass value="1.0"/>
            <origin rpy="0 0 0" xyz="0 0 0.15"/>
            <inertia ixx="0.01396" iyy="0.01396" izz="0.00125" ixy="0" ixz="0" iyz="0"/>
        </inertial>
        <visual>
            <geometry>
                <cylinder length="0.3" radius="0.04"/>
            </geometry>
            <material name="orange">
                <color rgba="1.0 0.6 0.0 1"/>
            </material>
            <origin rpy="0 0 0" xyz="0 0 0.15"/>
        </visual>
        <collision>
            <geometry>
                <cylinder length="0.3" radius="0.04"/>
            </geometry>
            <origin rpy="0 0 0" xyz="0 0 0.15"/>
        </collision>
    </link>
    
    <!-- Joint 1 (Rotates around Z axis) -->
    <joint name="joint1" type="continuous">
        <axis xyz="0 0 1"/>
        <parent link="base_link"/>
        <child link="link1"/>
        <origin rpy="0 0 0" xyz="0 0 0.05"/>
    </joint>
    
    <!-- Link 2 (Upper arm) -->
    <link name="link2">
        <inertial>
            <mass value="0.8"/>
            <origin rpy="0 0 0" xyz="0 0 0.15"/>
            <inertia ixx="0.0078" iyy="0.0078" izz="0.0010" ixy="0" ixz="0" iyz="0"/>
        </inertial>
        <visual>
            <geometry>
                <cylinder length="0.3" radius="0.04"/>
            </geometry>
            <material name="orange">
                <color rgba="1.0 0.6 0.0 1"/>
            </material>
            <origin rpy="0 0 0" xyz="0 0 0.15"/>
        </visual>
        <collision>
            <geometry>
                <cylinder length="0.3" radius="0.04"/>
            </geometry>
            <origin rpy="0 0 0" xyz="0 0 0.15"/>
        </collision>
    </link>
    
    <!-- Joint 2 (Shoulder - rotates around Y axis) -->
    <joint name="joint2" type="revolute">
        <axis xyz="0 1 0"/>
        <limit velocity="1.0" effort="30.0" upper="1.5708" lower="-1.5708"/>
        <parent link="link1"/>
        <child link="link2"/>
        <origin rpy="0 1.5708 0" xyz="0 0 0.3"/>
    </joint>
    
    <!-- Link 3 (Lower arm) -->
    <link name="link3">
        <inertial>
            <mass value="0.6"/>
            <origin rpy="0 0 0" xyz="0 0 0.125"/>
            <inertia ixx="0.0045" iyy="0.0045" izz="0.0008" ixy="0" ixz="0" iyz="0"/>
        </inertial>
        <visual>
            <geometry>
                <cylinder length="0.25" radius="0.035"/>
            </geometry>
            <material name="orange">
                <color rgba="1.0 0.6 0.0 1"/>
            </material>
            <origin rpy="0 0 0" xyz="0 0 0.125"/>
        </visual>
        <collision>
            <geometry>
                <cylinder length="0.25" radius="0.035"/>
            </geometry>
            <origin rpy="0 0 0" xyz="0 0 0.125"/>
        </collision>
    </link>
    
    <!-- Joint 3 (Elbow - rotates around Y axis) -->
    <joint name="joint3" type="revolute">
        <axis xyz="0 1 0"/>
        <limit velocity="1.0" effort="30.0" upper="1.5708" lower="-1.5708"/>
        <parent link="link2"/>
        <child link="link3"/>
        <origin rpy="0 0 0" xyz="0 0 0.3"/>
    </joint>
    
    <!-- Link 4 (End effector) -->
    <link name="end_effector">
        <inertial>
            <mass value="0.4"/>
            <origin rpy="0 0 0" xyz="0 0 0.1"/>
            <inertia ixx="0.0030" iyy="0.0030" izz="0.0006" ixy="0" ixz="0" iyz="0"/>
        </inertial>
        <visual>
            <geometry>
                <cylinder length="0.2" radius="0.03"/>
            </geometry>
            <material name="orange">
                <color rgba="1.0 0.6 0.0 1"/>
            </material>
            <origin rpy="0 0 0" xyz="0 0 0.1"/>
        </visual>
        <collision>
            <geometry>
                <cylinder length="0.2" radius="0.03"/>
            </geometry>
            <origin rpy="0 0 0" xyz="0 0 0.1"/>
        </collision>
    </link>
    
    <!-- Joint 4 (Wrist - rotates around Z axis) -->
    <joint name="joint4" type="continuous">
        <axis xyz="0 0 1"/>
        <parent link="link3"/>
        <child link="end_effector"/>
        <origin rpy="0 0 0" xyz="0 0 0.25"/>
    </joint>
    
    <!-- Transmissions for ROS control -->
    <transmission name="tran1">
        <type>transmission_interface/SimpleTransmission</type>
        <joint name="joint1">
            <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
        </joint>
        <actuator name="motor1">
            <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
            <mechanicalReduction>1</mechanicalReduction>
        </actuator>
    </transmission>
    
    <transmission name="tran2">
        <type>transmission_interface/SimpleTransmission</type>
        <joint name="joint2">
            <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
        </joint>
        <actuator name="motor2">
            <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
            <mechanicalReduction>1</mechanicalReduction>
        </actuator>
    </transmission>
    
    <transmission name="tran3">
        <type>transmission_interface/SimpleTransmission</type>
        <joint name="joint3">
            <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
        </joint>
        <actuator name="motor3">
            <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
            <mechanicalReduction>1</mechanicalReduction>
        </actuator>
    </transmission>
    
    <transmission name="tran4">
        <type>transmission_interface/SimpleTransmission</type>
        <joint name="joint4">
            <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
        </joint>
        <actuator name="motor4">
            <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
            <mechanicalReduction>1</mechanicalReduction>
        </actuator>
    </transmission>
    
    <!-- Gazebo plugins for ROS2 control -->
    <gazebo>
        <plugin name="control" filename="libgazebo_ros_control.so"/>
    </gazebo>
    <gazebo>
        <plugin name="joint_state_publisher" filename="libgazebo_ros_joint_state_publisher.so">
            <jointName>joint1, joint2, joint3, joint4</jointName>
        </plugin>
    </gazebo>
</robot>